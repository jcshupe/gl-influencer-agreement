<!-- EmailJS + jsPDF para enviar el contrato en PDF al correo de JC Green Life NYC -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  //  INICIALIZAR EMAILJS con tu Public Key
  (function () {
    emailjs.init({
      publicKey: "CL8wV4fPeV2hwUvjPQYRz",
    });
  })();

  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("agreement-form");
    if (!form) return;

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const termsCheckbox = document.getElementById("accept-terms");
      if (termsCheckbox && !termsCheckbox.checked) {
        alert("Por favor acepta los t茅rminos de colaboraci贸n antes de enviar.");
        return;
      }

      const fullnameInput  = document.getElementById("fullname");
      const instagramInput = document.getElementById("instagram");
      const emailInput     = document.getElementById("email");

      const fullname  = fullnameInput  ? fullnameInput.value.trim()  : "";
      const instagram = instagramInput ? instagramInput.value.trim() : "";
      const email     = emailInput     ? emailInput.value.trim()     : "";

      const timestamp = new Date().toLocaleString("es-DO", {
        timeZone: "America/New_York",
      });

      const pdfDataUri = await generarPDFContrato(fullname, instagram, email, timestamp);

      try {
        await emailjs.send("service_x97sa0l", "template_sjqizpi", {
          fullname: fullname,
          instagram: instagram,
          email: email,
          timestamp: timestamp,
          contrato_pdf: pdfDataUri,
        });

        alert("隆Gracias! Tu aceptaci贸n ha sido registrada.");
        form.reset();

      } catch (error) {
        console.error("Error al enviar el correo con EmailJS:", error);
        alert("Tu aceptaci贸n se registr贸, pero hubo un problema enviando el email.");
      }
    });
  });

  async function generarPDFContrato(fullname, instagram, email, timestamp) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(16);
    doc.text("JC GREEN LIFE NYC", 105, 15, { align: "center" });
    doc.text("Acuerdo de Colaboraci贸n de Influencers", 105, 23, { align: "center" });

    doc.setFontSize(11);
    let y = 40;

    doc.text(`Nombre completo: ${fullname}`, 20, y); y += 8;
    doc.text(`Usuario de Instagram: ${instagram}`, 20, y); y += 8;
    doc.text(`Correo electr贸nico: ${email}`, 20, y); y += 8;
    doc.text(`Fecha y hora de aceptaci贸n: ${timestamp}`, 20, y); y += 12;

    doc.text("Resumen del acuerdo:", 20, y); y += 8;
    doc.text("- Intercambio de comidas/servicio por contenido.", 20, y); y += 6;
    doc.text("- No incluye pago en efectivo.", 20, y); y += 6;
    doc.text("- Uso autorizado de imagen y contenido generado.", 20, y); y += 6;
    doc.text("- Duraci贸n de 90 d铆as de colaboraci贸n.", 20, y); y += 6;

    return doc.output("datauristring");
  }
</script>
